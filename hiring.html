<!DOCTYPE html>
<html lang="en" dir="ltr" prefix="content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <link rel="icon" href="sites/default/files/DF-icon.png" type="image/png" />
  <title>KYC Verification | Earnly Community</title>

  <!-- Keep original styles for header/footer consistency -->
  <link rel="stylesheet" media="all" href="sites/default/files/css/css_00XtlT92vPE8qi_H7eio-S8ptBMuBzylThSbHv0OvkA.css" />
  <link rel="stylesheet" media="all" href="sites/default/files/css/css_JVvSp_9qtnhmrjzYSDBXzPsyAPRBDwv-7pU94CXtcEI.css" />
  <link rel="stylesheet" media="all" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" />
  <link rel="stylesheet" media="all" href="sites/default/files/css/css_Ck_Ig0ffzfMmugtjrwFW-HUA3-WvQy-2ljEdPZ5A2Wk.css" />
  <link rel="stylesheet" media="all" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css" />
  <link rel="stylesheet" media="all" href="sites/default/files/css/css_y0ifvFTJn3OpgwHT5WKDDy7_cLBXaDbcecFM0yx9f2Y.css" />

  <!-- Custom CSS to make form feel native -->
  <style>
    body {
      background-color: #fafaf5; /* Creamy background */
      margin: 0;
      padding: 0;
    }
    #form-container {
      background: #fafaf5;
      padding: 0;
      margin: 0;
      border: none;
      width: 100%;
      max-width: 100%;
      min-height: 800px; /* Adjust if form is taller */
    }
    .section {
      padding-top: 2rem;
      padding-bottom: 2rem;
    }
    /* Force form to fill container without scroll */
    formester-standard-form {
      height: 100% !important;
      width: 100% !important;
      display: block;
      overflow: hidden;
    }
    /* Optional: Hide scrollbar in modern browsers */
    ::-webkit-scrollbar {
      display: none;
    }
    /* For Firefox */
    * {
      scrollbar-width: none;
    }
  </style>
<!-- Meta Pixel Code -->
<script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '840710271678783');
  fbq('track', 'PageView');
</script>
<noscript>
  <img height="1" width="1" style="display:none"
       src="https://www.facebook.com/tr?id=840710271678783&ev=PageView&noscript=1"/>
</noscript>
<!-- End Meta Pixel Code -->

</head>
<body class="layout-no-sidebars page-node-5 path-node page-node-type-page">
  <a href="#main-content" class="visually-hidden focusable skip-link">Skip to main content</a>
  <div class="dialog-off-canvas-main-canvas" data-off-canvas-main-canvas>
    <div id="page-wrapper">
      <div id="page">
        <!-- HEADER (unchanged) -->
        <header id="header" class="header" role="banner" aria-label="Site header">
          <nav class="navbar fixed-top bg-primary navbar-expand-lg" id="navbar-main">
            <div class="container">
              <a href="index.html" title="Home" rel="home" class="navbar-brand">
                <img src="sites/default/files/DataForce_Logo_Black_Resized_B2C.png" alt="Home" class="img-fluid d-inline-block align-top" />
              </a>
              <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#CollapsingNavbar" aria-controls="CollapsingNavbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="CollapsingNavbar">
                <nav role="navigation" aria-labelledby="block-tls-main-menu-menu" id="block-tls-main-menu" class="block block-menu navigation menu--main">
                  <ul block="block-tls-main-menu" class="clearfix nav navbar-nav">
                    <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
                    <li class="nav-item"><a href="projects.html" class="nav-link">Find Project</a></li>
                    <li class="nav-item"><a href="hiring.html" class="nav-link">Join Us</a></li>
                    <li class="nav-item"><a href="form/contact.html" class="nav-link">Get In Touch</a></li>
                  </ul>
                </nav>
              </div>
            </div>
          </nav>
        </header>

        <!-- MAIN CONTENT: ONLY THE FORM -->
        <div id="main-wrapper" class="layout-main-wrapper clearfix">
          <div id="main" class="">
            <div class="row-offcanvas row-offcanvas-left clearfix">
              <main class="main-content col" id="content" role="main">
                <section class="section">
                  <div class="container">
                    <div id="form-container">
<!-- CUSTOM KYC FORM WITH SUMSUB + SUPABASE -->
<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-sm" style="border-radius:12px; border:1px solid #eaeaea; margin-top:2rem; margin-bottom:4rem;">
        <div class="card-body p-4">
          <h2 class="h4 mb-4 text-center">Join the Earnly Community</h2>

          <form id="kycForm">
            <!-- Full Name -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label small text-muted">First Name</label>
                <input type="text" name="firstName" class="form-control" required>
              </div>
              <div class="col-md-6">
                <label class="form-label small text-muted">Last Name</label>
                <input type="text" name="lastName" class="form-control" required>
              </div>
            </div>

            <!-- DOB -->
            <div class="mb-3">
              <label class="form-label small text-muted">Date of Birth</label>
              <input type="date" name="dob" class="form-control" required>
            </div>

            <!-- Email -->
            <div class="mb-3">
              <label class="form-label small text-muted">Email</label>
              <input type="email" name="email" class="form-control" required>
            </div>

            <!-- Address -->
            <div class="mb-3">
              <label class="form-label small text-muted">Full Address</label>
              <input type="text" name="address" class="form-control" placeholder="123 Main St, City, State, ZIP" required>
            </div>

            <!-- Sumsub Identity Verification -->
            <div class="mb-4">
              <h5 class="mb-2">Identity Verification</h5>
              <p class="text-muted small mb-3">We'll securely verify your ID with Sumsub</p>
              <div id="sumsub-container" style="border:1px solid #eaeaea; border-radius:8px; padding:16px; background:#fafafa; min-height:300px;">
                <p class="text-center text-muted">Loading secure verification...</p>
              </div>
              <input type="hidden" name="sumsubApplicantId" id="sumsubApplicantId">
            </div>

            <!-- SSN -->
            <div class="mb-4">
              <label class="form-label small text-muted">Social Security Number (SSN)</label>
              <input type="text" name="ssn" class="form-control" placeholder="XXX-XX-1234" maxlength="11" autocomplete="off" required>
              <div class="form-text text-muted small">Used for IRS verification. Stored securely.</div>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="btn btn-primary w-100 py-2 fw-bold" id="submitBtn" disabled>
              Submit Application
            </button>
            <div id="formMessage" class="mt-3 text-center" style="min-height:24px;"></div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Sumsub & Supabase Scripts -->
<script src="https://static.sumsub.com/idensic/static/sns-websdk-builder.js"></script>
<script>
  // Auto-format SSN as user types
  document.querySelector('input[name="ssn"]').addEventListener('input', function(e) {
    let v = e.target.value.replace(/\D/g, '');
    if (v.length > 9) v = v.slice(0, 9);
    e.target.value = v.replace(/(\d{3})(\d{2})(\d{0,4})/, (_, a, b, c) => `${a}-${b}-${c}`);
  });

  // Load Sumsub SDK
  window.SNSWebSdkBuilder(null, null, 'https://api.sumsub.com')
    .withAccessTokenProvider(() =>
      fetch('https://api.sumsub.com/resources/accessTokens?ttlInSecs=600', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          appId: 'sbx:lRlxFT7jYTJAog6Yd7r9aNNZ.Z0xWBbHHPgFWDyLZ4SNsjBnQIEgAK7Bk'
        })
      }).then(r => r.json()).then(d => d.token)
    )
    .withContainerId('sumsub-container')
    .withHandlers({
      onError: (err) => {
        document.getElementById('formMessage').innerHTML = '<div class="text-danger">Verification failed. Please try again.</div>';
        console.error('Sumsub error:', err);
      },
      onMessage: (type, payload) => {
        if (type === 'applicantCreated') {
          document.getElementById('sumsubApplicantId').value = payload.applicantId;
        }
        if (type === 'completed') {
          document.getElementById('submitBtn').disabled = false;
          document.getElementById('formMessage').innerHTML = '<div class="text-success">âœ… Identity verified!</div>';
        }
      }
    })
    .build()
    .launch();

  // Handle form submission to Supabase
  document.getElementById('kycForm')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const btn = document.getElementById('submitBtn');
    const msg = document.getElementById('formMessage');
    btn.disabled = true;
    msg.innerHTML = '<div class="text-muted">Submitting your application...</div>';

    const formData = new FormData(e.target);
    const applicant = {
      first_name: formData.get('firstName'),
      last_name: formData.get('lastName'),
      dob: formData.get('dob'),
      email: formData.get('email'),
      address: formData.get('address'),
      ssn: 'SSN_HIDDEN_FOR_TEST', // ðŸ”’ Never store real SSN in plain text
      sumsub_applicant_id: formData.get('sumsubApplicantId'),
      sumsub_status: 'verified'
    };

    // Send to Supabase REST API
    const response = await fetch('https://qugxahwlcfzoytzkidde.supabase.co/rest/v1/applicants', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'apikey': 'sb_publishable_ukSuU9bJH8BRYjtj0F7FsA_ezK1ydtg',
        'Authorization': 'Bearer sb_publishable_ukSuU9bJH8BRYjtj0F7FsA_ezK1ydtg',
        'Prefer': 'return=representation'
      },
      body: JSON.stringify(applicant)
    });

    if (response.ok) {
      msg.innerHTML = '<div class="text-success h5">âœ… Application submitted successfully!</div>';
      // Optional: reset form after 2 seconds
      setTimeout(() => {
        e.target.reset();
        document.getElementById('sumsub-container').innerHTML = '<p class="text-center text-muted">Verification complete.</p>';
      }, 2000);
    } else {
      const error = await response.text();
      msg.innerHTML = '<div class="text-danger">Submission failed. Please try again.</div>';
      console.error('Supabase error:', error);
      btn.disabled = false;
    }
  });
</script>
                    </div>
                  </div>
                </section>
              </main>
            </div>
          </div>
        </div>

        <!-- FOOTER (unchanged) -->
        <div class="featured-bottom">
          <aside class="container clearfix" role="complementary">
            <section class="row region region-featured-bottom-first">
              <div id="block-tempcss" class="block block-block-content block-block-contentcf6287ce-167e-4a31-aae1-630b811cd203">
                <div class="content"></div>
              </div>
            </section>
          </aside>
        </div>
        <footer class="site-footer">
          <div class="main-footer-container col-md-12">
            <div class="container">
              <section class="row region region-footer-first">
                <div id="block-footerlinks" class="block block-block-content block-block-content2b8cc63e-72e4-4ab2-ae95-522b6172d209">
                  <div class="content">
                    <p><a href="index.html" id="footer-logo"><img alt="Home" src="sites/default/files/DataForce_Logo_All_White.png" /></a></p>
                  </div>
                </div>
              </section>
            </div>
          </div>
          <div class="footer-copywrite-section">
            <div class="container">
              <div class="copywrite-text">
                <section class="row region region-footer-second">
                  <div id="block-copyrightinfo" class="block block-block-content block-block-content2671b723-2281-49ac-baee-83737965686b">
                    <div class="content">
                      <div class="row text-left" style="max-width: 400px; margin: 0 auto;">
                        <div class="col-12 pt-3"><p>Earnly @ 2025 All Rights Reserved</p></div>
                      </div>
                    </div>
                  </div>
                </section>
              </div>
              <div class="copywrite-links">
                <section class="row region region-footer-third">
                  <div id="block-footersitemaplinks" class="block block-block-content block-block-content10066937-44b7-42a2-87c0-792df708f34a">
                    <div class="content">
                      <ul>	<li><a href="privacy.html">Data Privacy</a></li> <li><a href="https://earnly.us">Parent Company</a></li> <li><a href="FAQ.html">FAQ</a></li> 
</ul>
                    </div>
                  </div>
                </section>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>
  </div>

  <!-- Keep required scripts for mobile menu/footer -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
</body>
</html>